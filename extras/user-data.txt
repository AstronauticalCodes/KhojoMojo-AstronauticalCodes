Content-Type: multipart/mixed; boundary="//"
MIME-Version: 1.0

--//
Content-Type: text/cloud-config; charset="us-ascii"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment;
 filename="cloud-config.txt"

#cloud-config
cloud_final_modules:
- [scripts-user, always]
--//
Content-Type: text/x-shellscript; charset="us-ascii"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment; filename="userdata.txt"

#!/bin/bash

# update the package list
echo "Starting script"
sudo yum update -y

# install docker and git
echo "Installing docker and git"
sudo yum install -y docker git

# start the docker service
echo "Starting docker service"
sudo service docker start

# add the ec2-user to the docker group
echo "Adding user to the docker group"
sudo usermod -a -G docker ec2-user

# download and install docker compose cli plugin
echo "Downloading and installing docker compose"
DOCKER_CONFIG=/usr/local/lib/docker
sudo mkdir -p $DOCKER_CONFIG/cli-plugins
sudo curl -SL https://github.com/docker/compose/releases/download/v2.29.6/docker-compose-linux-x86_64 -o $DOCKER_CONFIG/cli-plugins/docker-compose

# apply executable permissions to the binary
sudo chmod +x $DOCKER_CONFIG/cli-plugins/docker-compose

# add docker-compose to PATH
export PATH=$PATH:$DOCKER_CONFIG/cli-plugins

# go to home directory
cd /home/ec2-user

# clone the repository
echo "Cloning git repo"
git clone https://github.com/JohnRaizada/KhojoMojo.git

# go to the cloned directory
cd KhojoMojo

# git pull
echo "Updating local"
git pull

# run the docker compose
echo "Running docker"
docker compose up -d

--//--
